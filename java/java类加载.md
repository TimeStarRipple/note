# java类加载

先加载父类静态，子类静态

## 步骤

1. 加载：将类的class文件读入内存，并为之创建一个java.lang.Class对象，也就是说当系统中使用任何类时，系统都会为之简历一个java.lang.Class对象，类的加载通常是由类加载器完成。
2. 连接：当类被加载之后，系统为之生成一个对应的Class对象，然后进入连接阶段，连接阶段负责把类的二进制数据合并到JRE当中。
3. 初始化：虚拟机对类进行初始化，主要是类变量进行初始化

### 加载

将类的class文件读入内存，并为之创建一个java.lang.Class对象，也就是说当系统中使用任何类时，系统都会为之简历一个java.lang.Class对象，类的加载通常是由类加载器完成。

### 类的连接

当类被加载之后，系统为之生成一个对应的Class对象，然后进入连接阶段，连接阶段负责把类的二进制数据合并到JRE当中。类连接可以分成三个阶段。

1. 验证：用于检验被加载的类是否有正确的内部结构，并和其他类协调一致
2. 准备：负责为类变量分配内存，并设置默认初始值
3. 解析：将类的二进制数据中的符号引用替换成直接引用

### 类的初始化

虚拟机对类进行初始化，主要是类变量进行初始化，一般有两种初始化方式

1. 声明类变量时指定初始值
2. 使用静态初始化块为类变量指定初始值

## JVM初始化类

1. 假如这个类还没有被加载和连接，则程序先加载并连接该类
2. 假如这个类的直接父类还没有被初始化，则先初始化其直接父类
3. 假如类中有初始化语句，则系统依次执行这些初始化语句

当执行第2个步骤时，系统对直接父类的初始化步骤也遵循此步骤1-3；如果该直接父类又有直接父类，则系统再重复这三个步骤。。。依次类推

### 类初始化时机

当java程序首次通过下面6种方式来使用某个类或接口，系统就会初始化该类或接口

1. 创建类的实例。使用new操作符，通过反射，通过反序列化方式
2. 调用某个类的类方法
3. 访问某个类或接口的类变量，或为他赋值
4. 通过反射方法强制创建某个类或接口对应的Class对象
5. 初始化某个类的子类
6. 直接使用java.exe命令来运行某个类的子类

另外对于编译器就能确定下来的final的类变量

### 标识符

全限定名（代表包名加类名）加类加载器

### 类加载器

1. Bootstrap ClassLoader：根类加载器，加载java核心类，不是ClassLoader的子类，不是java实现，而是由JVM自身实现的
2. Extension ClassLoader：扩展类加载器，加载jre扩展目录下的jar包
3. System ClassLoader：系统类加载器，java命令下指定要加载的jar包
4. App ClassLoader自定义类加载器：像tomcat中定义的加载器

这四类加载器，从上到下继承实现，由于根加载器不是java实现，扩展类加载器无法得到根类加载器，得到的为null

### 类加载机制

* 全盘负责：一个类加载器负责加载某个类，就会加载他的父类
* 父类委托：先用父类加载器加载，不行才用子类加载
* 缓存机制：保证所有加载的Class都会被缓存，使用某个类就会从缓存里面找，没有才会加载

## 类加载过程

![](/java/images/classLoader-1.png)



